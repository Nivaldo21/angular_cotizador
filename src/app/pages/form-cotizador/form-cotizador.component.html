<main class="container-xxl">
    <!-- titulo secciones -->
          <div class="tituloSecciones">
            <div class="row">
              <div class="col-12">
                <h2>Generar cotización</h2>
                <nav aria-label="breadcrumb">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a >Ventas</a></li>
                    <li class="breadcrumb-item"><a >Cotizador</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Generar cotización</li>
                  </ol>
                </nav>
              </div>
            </div>
          </div>
          
    <!-- Filtros -->
          <div class="my-3 p-4 bg-body rounded shadow-sm">
            <div>
              <!-- 1ra linea -->
              <div class="row">
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                  <label for="" class="form-label">CLIENTE / PROSPECTO</label>
                  <ng-select [items]="clienteOptions" [disabled]="action ? action : false"
                          [addTag]="true"
                          addTagText="Añadir Prospecto"
                          bindLabel="CLI_NOMBRE"  
                          [(ngModel)]="selectedCliente">
                  </ng-select>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                  <label for="" class="form-label">TIPO CLIENTE</label>
                  <select class="form-select" [(ngModel)]="cliente_selected" (ngModelChange)="onParam_industria()" [disabled]="action ? action : false">
                    <option value="">- Seleccionar -</option>
                    <option value="Automotriz">Automotriz</option>
                    <option value="Appliance">Appliance</option>
                    <option value="Energías renovables">Energías renovables</option>
                    <option value="Consumibles">Consumibles</option>
                  </select>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                  <label for="" class="form-label">TIPO PROCESO</label>
                  <select class="form-select" [(ngModel)]="proceso_selected"  (ngModelChange)="onProceso_Maquina()" [disabled]="action ? action : false">
                    <option value="">- Seleccionar -</option>
                    <option value="plastico">Plástico</option>
                    <option value="metal">Metal</option>
                  </select>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                  <label for="" class="form-label">PRECIOS</label>
                  <select class="form-select" [(ngModel)]="precio_selected" (ngModelChange)="onParam_industria()" [disabled]="action ? action : false">
                    <option value="">- Seleccionar -</option>
                    <option value="Mínimo">Mínimo</option>
                    <option value="Medio">Medio</option>
                    <option value="Máximo">Máximo</option>
                  </select>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                  <label for="" class="form-label">VENDEDOR</label>
                  <ng-select [items]="vendedoresOptions" [disabled]="action ? action : false"
                    [addTag]="true"
                    addTagText="Añadir Vendedor"
                    bindLabel="nombre_vendedor"
                    [(ngModel)]="selectedVendedor">
                  </ng-select>
                </div>
              </div>
              <!-- 2da linea -->
              <div class="row">
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                  <label for="" class="form-label">CÓDIGO DE PARTE</label>
                  <ng-select [items]="partesOptions" [disabled]="action ? action : false"
                    bindLabel="codigo_parte"
                    [addTag]="true"
                    addTagText="Añadir nuevo código"
                    (ngModelChange)="onParteSelected(1,$event)"
                    [(ngModel)]="selectedParte_codigo"
                    maxlength="30">
                  </ng-select>
                </div>
                <div class="col-sm-12 col-md-8 col-lg-6 col-xl-4 mb-3">
                  <label for="" class="form-label">DESCRIPCIÓN PARTE</label>
                  <ng-select [items]="partesOptions" [disabled]="action ? action : false"
                    [addTag]="true"
                    addTagText="Añadir nueva descripción"
                    bindLabel="nombre_parte"
                    (ngModelChange)="onParteSelected(2,$event)"
                    [(ngModel)]="selectedParte_descripcion">
                  </ng-select>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                  <label for="" class="form-label">CAV</label>
                  <input type="number" [(ngModel)]="cav" (ngModelChange)="calculateWeigth()" class="form-control" [disabled]="action ? action : false">
                </div>
              </div>
              <!-- 3ra linea -->
            </div>
    <!-- COMIENZA ACORDEON -->
            <div>
              <div class="accordion" id="accordionPanelsStayOpenExample">
    <!-- MATERIA PRIMA -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="panelHead-materiaPrima">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelmateriaPrima" aria-expanded="true" aria-controls="panelmateriaPrima">
                      Materia prima
                    </button>
                  </h2>
                  <div id="panelmateriaPrima" class="accordion-collapse collapse show" aria-labelledby="panelHead-materiaPrima">
                    <div class="accordion-body">
                      <form  *ngIf="!action" [formGroup]="form_materiaPrima" (submit)="flag_edit_materiaP ? confirmEditarItem() : setMateriaPrima() " >
                        <div class="row">
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="codigo_materia_prima" class="form-label">CÓDIGO MATERIA PRIMA</label>
                            <ng-select formControlName="codigo_materia_prima" name="codigo_materia_prima" [items]="materialesOptions"
                              [addTag]="true"
                              addTagText="Añadir nuevo código"
                              bindLabel="codigo_material"
                              (ngModelChange)="onMaterialSelected(1,$event)">
                            </ng-select>
                            <div  *ngIf="form_materiaPrima.get('codigo_materia_prima')?.invalid && (form_materiaPrima.get('codigo_materia_prima')?.dirty || form_materiaPrima.get('codigo_materia_prima')?.touched)">
                              <small *ngIf="form_materiaPrima.get('codigo_materia_prima')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            </div>
                          </div>
                          <div class="col-sm-12 col-md-8 col-lg-6 col-xl-4 mb-3">
                            <label for="descripcion_materia_prima" class="form-label">DESCRIPCIÓN MATERIA PRIMA</label>
                            <ng-select formControlName="descripcion_materia_prima" name="descripcion_materia_prima" [items]="materialesOptions"
                              [addTag]="true"
                              addTagText="Añadir nombre material"
                              bindLabel="nombre_material"
                              (ngModelChange)="onMaterialSelected(2,$event)">
                            </ng-select>
                            <div  *ngIf="form_materiaPrima.get('descripcion_materia_prima')?.invalid && (form_materiaPrima.get('descripcion_materia_prima')?.dirty || form_materiaPrima.get('descripcion_materia_prima')?.touched)">
                              <small *ngIf="form_materiaPrima.get('descripcion_materia_prima')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="SUPPLIER_RESIN" class="form-label">SUPPLIER RESIN</label>
                            <input type="text" class="form-control" formControlName="SUPPLIER_RESIN" name="SUPPLIER_RESIN">
                            <div  *ngIf="form_materiaPrima.get('SUPPLIER_RESIN')?.invalid && (form_materiaPrima.get('SUPPLIER_RESIN')?.dirty || form_materiaPrima.get('SUPPLIER_RESIN')?.touched)">
                              <small *ngIf="form_materiaPrima.get('SUPPLIER_RESIN')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('SUPPLIER_RESIN')?.errors?.['maxlength']" class="text-danger text">❌ Maximo 100 caracteres</small>
                            </div>
                          </div>
                        </div>
                        <div class="row mt-3">
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="parte_g" class="form-label">PART (g)</label>
                            <input type="number" class="form-control" formControlName="parte_g" (ngModelChange)="calculatedValue()" name="parte_g">
                            <div  *ngIf="form_materiaPrima.get('parte_g')?.invalid && (form_materiaPrima.get('parte_g')?.dirty || form_materiaPrima.get('parte_g')?.touched)">
                              <small *ngIf="form_materiaPrima.get('parte_g')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('parte_g')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="RUNNER_percent" class="form-label">RUNNER %</label>
                            <input type="number" class="form-control" formControlName="RUNNER_percent" (ngModelChange)="calculatedValue()" name="RUNNER_percent" >
                            <div  *ngIf="form_materiaPrima.get('RUNNER_percent')?.invalid && (form_materiaPrima.get('RUNNER_percent')?.dirty || form_materiaPrima.get('RUNNER_percent')?.touched)">
                              <small *ngIf="form_materiaPrima.get('RUNNER_percent')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('RUNNER_percent')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="RUNNER_g" class="form-label">RUNNER (g)</label>
                            <input type="number" class="form-control disabled" formControlName="RUNNER_g" name="RUNNER_g" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('RUNNER_g')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal(11,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="loss_percent" class="form-label">LOSS %</label>
                            <input type="number" class="form-control" formControlName="loss_percent" name="loss_percent" (ngModelChange)="calculateWeigth()">
                            <div  *ngIf="form_materiaPrima.get('loss_percent')?.invalid && (form_materiaPrima.get('loss_percent')?.dirty || form_materiaPrima.get('loss_percent')?.touched)">
                              <small *ngIf="form_materiaPrima.get('loss_percent')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('loss_percent')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal(6,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="weigth" class="form-label">WEIGTH / 100</label>
                            <input type="number" class="form-control disabled" formControlName="weigth" name="weigth" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('weigth')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="resin_basis" class="form-label">RESIN - BASIS</label>
                            <input type="number" class="form-control" formControlName="resin_basis" name="resin_basis" (ngModelChange)="calculateResinCot()">
                            <div  *ngIf="form_materiaPrima.get('resin_basis')?.invalid && (form_materiaPrima.get('resin_basis')?.dirty || form_materiaPrima.get('resin_basis')?.touched)">
                              <small *ngIf="form_materiaPrima.get('resin_basis')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('resin_basis')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="overhead_cost" class="form-label">% OVERHEAD COST</label>
                            <input type="number" class="form-control" formControlName="overhead_cost" name="overhead_cost" (ngModelChange)="calculateResinCot()">
                            <div  *ngIf="form_materiaPrima.get('overhead_cost')?.invalid && (form_materiaPrima.get('overhead_cost')?.dirty || form_materiaPrima.get('overhead_cost')?.touched)">
                              <small *ngIf="form_materiaPrima.get('overhead_cost')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('overhead_cost')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="resin_cot" class="form-label">RESIN COT</label>
                            <input type="number" class="form-control disabled" formControlName="resin_cot" name="resin_cot" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('resin_cot')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="total_mat" class="form-label">TOTAL MAT</label>
                            <input type="number" class="form-control disabled" formControlName="total_mat" name="total_mat" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('total_mat')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="GK_percent" class="form-label">GK %</label>
                            <input type="number" class="form-control" formControlName="GK_percent" name="GK_percent" (ngModelChange)="calculateGK()">
                            <div  *ngIf="form_materiaPrima.get('GK_percent')?.invalid && (form_materiaPrima.get('GK_percent')?.dirty || form_materiaPrima.get('GK_percent')?.touched)">
                              <small *ngIf="form_materiaPrima.get('GK_percent')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('GK_percent')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="GK" class="form-label">GK</label>
                            <input type="number" class="form-control disabled" formControlName="GK" name="GK" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('GK')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="scrap_percent" class="form-label">SCRAP %</label>
                            <input type="number" class="form-control" formControlName="scrap_percent" name="scrap_percent" (ngModelChange)="calculateMarginScrap()">
                            <div  *ngIf="form_materiaPrima.get('scrap_percent')?.invalid && (form_materiaPrima.get('scrap_percent')?.dirty || form_materiaPrima.get('scrap_percent')?.touched)">
                              <small *ngIf="form_materiaPrima.get('scrap_percent')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('scrap_percent')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="margin_scrap" class="form-label">MARGIN SCRAP</label>
                            <input type="number" class="form-control disabled" formControlName="margin_scrap" name="margin_scrap" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('margin_scrap')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="margin_2" class="form-label">MARGIN 2</label>
                            <input type="number" class="form-control disabled" formControlName="margin_2" name="margin_2" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('margin_2')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="margen_seguridad_percent" class="form-label">% MARGEN SEGURIDAD</label>
                            <input type="number" class="form-control" formControlName="margen_seguridad_percent" name="margen_seguridad_percent" (ngModelChange)="calculateMarginSecurity()">
                            <div  *ngIf="form_materiaPrima.get('margen_seguridad_percent')?.invalid && (form_materiaPrima.get('margen_seguridad_percent')?.dirty || form_materiaPrima.get('margen_seguridad_percent')?.touched)">
                              <small *ngIf="form_materiaPrima.get('margen_seguridad_percent')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                              <small *ngIf="form_materiaPrima.get('margen_seguridad_percent')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                            </div>
                          </div>
                          <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <label for="margen_seguridad" class="form-label">MARGEN SEGURIDAD</label>
                            <input type="number" class="form-control disabled"  formControlName="margen_seguridad" name="margen_seguridad" [readOnly]="true">
                            <small *ngIf="form_materiaPrima.get('margen_seguridad')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                          <div class="col-sm-6 col-md-6 col-lg-4 col-xl-4 mb-3">
                            <button type="submit" class="btn btn-teal-line mt13">{{flag_edit_materiaP ? 'Editar materia prima' : 'Agregar otra materia prima'}}</button>
                            <button type="button" (click)="cancelarEditarItem()" class="btn btn-outline-danger mt13" style="margin-left: 10px;" *ngIf="flag_edit_materiaP">Cancelar edicion</button>
                          </div>
                        </div>
                      </form>
    <!-- TABLA MATERIA PRIMA -->
                      <div class="row mt-3 mb-4">
                        <div class="table-responsive">
                          <table class="table table-hover-all">
                            <thead>
                              <tr>
                                <th class="th7"><span>CÓDIGO MATERIA PRIMA</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th1"><span>DESCRIPCIÓN MATERIA PRIMA</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th0"><span>SUPPLIER RESIN</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>PART (g)</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>RUNNER %</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>RUNNER (g)</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>LOSS %</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>WEIGTH / 100</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>RESIN - BASIS</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th0"><span>OVERHEAD COST</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>RESIN COT</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>TOTAL MAT</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>GK %</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>GK</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>SCRAP %</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>MARGIN SCRAP</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th5"><span>MARGIN 2</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th7"><span>% MARGEN SEGURIDAD</span> <a href="#" class="thFlechas"></a></th>
                                <th class="th7"><span>MARGEN SEGURIDAD</span> <a href="#" class="thFlechas"></a></th>
                                <th class="text-center th2"  *ngIf="!action">ACCIONES</th>
                              </tr>
                            </thead>
                            <tbody *ngIf="array_materiaPrimas.length > 0">
                              <tr  *ngFor="let item of array_materiaPrimas; let i = index">
                                <td>{{item.codigo_materia_prima}}</td>
                                <td>{{item.descripcion_materia_prima}}</td>
                                <td>{{item.SUPPLIER_RESIN}}</td>
                                <td>{{item.parte_g}}</td>
                                <td>{{item.RUNNER_percent}}</td>
                                <td>{{item.RUNNER_g}}</td>
                                <td>{{item.loss_percent}}</td>
                                <td>{{item.weigth}}</td>
                                <td>{{item.resin_basis}}</td>
                                <td>{{item.overhead_cost}}</td>
                                <td>{{item.resin_cot}}</td>
                                <td>{{item.total_mat}}</td>
                                <td>{{item.GK_percent}}</td>
                                <td>{{item.GK}}</td>
                                <td>{{item.scrap_percent}}</td>
                                <td>{{item.margin_scrap}}</td>
                                <td>{{item.margin_2}}</td>
                                <td>{{item.margen_seguridad_percent}}</td>
                                <td>{{item.margen_seguridad}}</td>
                                <td class="text-center" *ngIf="!action">
                                  <button type="button" (click)="editarItem(i)" title="Modificar" class="btn-icon-action"><img src="assets/img/ic-editar.png"></button>
                                  <button type="button" (click)="eliminarItem(i)" title="Eliminar" class="btn-icon-action"><img src="assets/img/ic-eliminar.png"></button>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
    
                    </div>
                  </div>
                </div>
    <!-- MAQUINA -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="panelHead-Maquina">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelMaquina" aria-expanded="false" aria-controls="panelMaquina">
                      Máquina
                    </button>
                  </h2>
                  <div id="panelMaquina" class="accordion-collapse collapse" aria-labelledby="panelHead-Maquina">
                    <div class="accordion-body">
                      <form class="row" [formGroup]="form_maquina" >
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">TYPE</label>
                          <select class="form-select" formControlName="seletcedMaquina" (ngModelChange)="setCostoMaquina()">
                            <option value="">- Seleccionar -</option>
                            <option *ngFor="let item of opcionesMaquinas" [ngValue]="item">{{item.machine_type}}</option>
                          </select>
                          <div  *ngIf="form_maquina.get('seletcedMaquina')?.invalid && (form_maquina.get('seletcedMaquina')?.dirty || form_maquina.get('seletcedMaquina')?.touched)">
                            <small *ngIf="form_maquina.get('seletcedMaquina')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">COSTO / H</label>
                          <input type="number" class="form-control" formControlName="precioMaquina" (ngModelChange)="caclulate_production()">
                          <div  *ngIf="form_maquina.get('precioMaquina')?.invalid && (form_maquina.get('precioMaquina')?.dirty || form_maquina.get('precioMaquina')?.touched)">
                            <small *ngIf="form_maquina.get('precioMaquina')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                            <small *ngIf="form_maquina.get('precioMaquina')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">CYCLUS</label>
                          <input type="number" class="form-control"  formControlName="ciclo" (ngModelChange)="caclulate_production()">
                          <div  *ngIf="form_maquina.get('ciclo')?.invalid && (form_maquina.get('ciclo')?.dirty || form_maquina.get('ciclo')?.touched)">
                            <small *ngIf="form_maquina.get('ciclo')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">PCS / HR</label>
                          <input type="text" class="form-control"  formControlName="pcs_hr" (ngModelChange)="calculate_moq()">
                          <div  *ngIf="form_maquina.get('pcs_hr')?.invalid && (form_maquina.get('pcs_hr')?.dirty || form_maquina.get('pcs_hr')?.touched)">
                            <small *ngIf="form_maquina.get('pcs_hr')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            <small *ngIf="form_maquina.get('pcs_hr')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">% INEFICIENCIA</label>
                          <input type="text" class="form-control" formControlName="ineficiencia_percent" (ngModelChange)="calculateMargin_4()">
                          <div  *ngIf="form_maquina.get('ineficiencia_percent')?.invalid && (form_maquina.get('ineficiencia_percent')?.dirty || form_maquina.get('ineficiencia_percent')?.touched)">
                            <small *ngIf="form_maquina.get('ineficiencia_percent')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            <small *ngIf="form_maquina.get('ineficiencia_percent')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">PRODUCTION</label>
                          <input type="number" class="form-control disabled" formControlName="production" [readonly]="true">
                          <small *ngIf="form_maquina.get('production')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">MARGIN 4</label>
                          <input type="number" class="form-control disabled"  formControlName="margin_4" [readonly]="true">
                          <small *ngIf="form_maquina.get('margin_4')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
    <!-- EMPAQUE -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="panelHead-empaque">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelEmpaque" aria-expanded="false" aria-controls="panelEmpaque">
                      Empaque y Entrega
                    </button>
                  </h2>
                  <div id="panelEmpaque" class="accordion-collapse collapse" aria-labelledby="panelHead-empaque">
                    <div class="accordion-body">
                      <form class="row" [formGroup]="form_empaqueEntrega">
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">PACKING COST</label>
                          <input type="number" class="form-control" formControlName="packing_cost" (ngModelChange)="calculate_PACKING()"> 
                          <div  *ngIf="form_empaqueEntrega.get('packing_cost')?.invalid && (form_empaqueEntrega.get('packing_cost')?.dirty || form_empaqueEntrega.get('packing_cost')?.touched)">
                            <small *ngIf="form_empaqueEntrega.get('packing_cost')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            <small *ngIf="form_empaqueEntrega.get('packing_cost')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">PCS / PACKING</label>
                          <input type="number" class="form-control"  formControlName="parking_pcs" (ngModelChange)="calculate_PACKING()">
                          <div  *ngIf="form_empaqueEntrega.get('parking_pcs')?.invalid && (form_empaqueEntrega.get('parking_pcs')?.dirty || form_empaqueEntrega.get('parking_pcs')?.touched)">
                            <small *ngIf="form_empaqueEntrega.get('parking_pcs')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">PACKING</label>
                          <input type="number" class="form-control disabled" formControlName="packing" [readonly]="true">
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">PCS ENTREGA</label>
                          <input type="number" class="form-control" formControlName="pcs_entrega" (ngModelChange)="caclulate_logisticCost()">
                          <div  *ngIf="form_empaqueEntrega.get('pcs_entrega')?.invalid && (form_empaqueEntrega.get('pcs_entrega')?.dirty || form_empaqueEntrega.get('pcs_entrega')?.touched)">
                            <small *ngIf="form_empaqueEntrega.get('pcs_entrega')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">COSTO FLETE</label>
                          <input type="number" class="form-control" formControlName="costo_flete" (ngModelChange)="caclulate_logisticCost()">
                          <div  *ngIf="form_empaqueEntrega.get('costo_flete')?.invalid && (form_empaqueEntrega.get('costo_flete')?.dirty || form_empaqueEntrega.get('costo_flete')?.touched)">
                            <small *ngIf="form_empaqueEntrega.get('costo_flete')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            <small *ngIf="form_empaqueEntrega.get('costo_flete')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">COSTO LOGÍSTICO</label>
                          <input type="number" class="form-control disabled" formControlName="costo_logistico"  [readonly]="true">
                          <div  *ngIf="form_empaqueEntrega.get('costo_logistico')?.invalid && (form_empaqueEntrega.get('costo_logistico')?.dirty || form_empaqueEntrega.get('costo_logistico')?.touched)">
                            <small *ngIf="form_empaqueEntrega.get('costo_logistico')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            <small *ngIf="form_empaqueEntrega.get('costo_logistico')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">PACKING AND OUTSIDE SERVICE</label>
                          <input type="number" class="form-control disabled" formControlName="packing_outside_service" [readonly]="true">
                          <div  *ngIf="form_empaqueEntrega.get('packing_outside_service')?.invalid && (form_empaqueEntrega.get('packing_outside_service')?.dirty || form_empaqueEntrega.get('packing_outside_service')?.touched)">
                            <small *ngIf="form_empaqueEntrega.get('packing_outside_service')?.errors?.['required']" class="text-danger text">❌ Campo Requerido</small>
                            <small *ngIf="form_empaqueEntrega.get('packing_outside_service')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
    <!-- MANTENIMIENTO -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="panelHead-Mantenimiento">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelMantenimiento" aria-expanded="false" aria-controls="panelMantenimiento">
                      Mantenimiento Herramental
                    </button>
                  </h2>
                  <div id="panelMantenimiento" class="accordion-collapse collapse" aria-labelledby="panelHead-Mantenimiento">
                    <div class="accordion-body">
                      <form class="row" [formGroup]="form_mantenimientoHerramental">
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">HR MTTO</label>
                          <input type="number" class="form-control" formControlName="hr_mantto" (ngModelChange)="calculate_tooling_mantiance()">
                          <div  *ngIf="form_mantenimientoHerramental.get('hr_mantto')?.invalid && (form_mantenimientoHerramental.get('hr_mantto')?.dirty || form_mantenimientoHerramental.get('hr_mantto')?.touched)">
                            <small *ngIf="form_mantenimientoHerramental.get('hr_mantto')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                            <small *ngIf="form_mantenimientoHerramental.get('hr_mantto')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">COST / HR</label>
                          <input type="number" class="form-control" formControlName="precioMaquina" (ngModelChange)="caclulate_production()">
                          <div  *ngIf="form_mantenimientoHerramental.get('precioMaquina')?.invalid && (form_mantenimientoHerramental.get('precioMaquina')?.dirty || form_mantenimientoHerramental.get('precioMaquina')?.touched)">
                            <small *ngIf="form_mantenimientoHerramental.get('precioMaquina')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">PCS / MANTTO</label>
                          <input type="number" class="form-control" formControlName="pcs_mtto" (ngModelChange)="calculate_tooling_mantiance()">
                          <div  *ngIf="form_mantenimientoHerramental.get('pcs_mtto')?.invalid && (form_mantenimientoHerramental.get('pcs_mtto')?.dirty || form_mantenimientoHerramental.get('pcs_mtto')?.touched)">
                            <small *ngIf="form_mantenimientoHerramental.get('pcs_mtto')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">TOOLING MANTIANCE</label>
                          <input type="number" class="form-control disabled" formControlName="tooling_maintance" [readOnly]="true">
                          <div  *ngIf="form_mantenimientoHerramental.get('tooling_maintance')?.invalid && (form_mantenimientoHerramental.get('tooling_maintance')?.dirty || form_mantenimientoHerramental.get('tooling_maintance')?.touched)">
                            <small *ngIf="form_mantenimientoHerramental.get('tooling_maintance')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                            <small *ngIf="form_mantenimientoHerramental.get('tooling_maintance')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
    <!-- TOTALES PIEZAS -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="panelHead-totalesPiezas">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#paneltotalesPiezas" aria-expanded="false" aria-controls="paneltotalesPiezas">
                      Totales pieza
                    </button>
                  </h2>
                  <div id="paneltotalesPiezas" class="accordion-collapse collapse" aria-labelledby="panelHead-totalesPiezas">
                    <div class="accordion-body">
                      <form class="row" [formGroup]="form_totalesPiezas">
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">% OVERHEAD</label>
                          <input type="number" class="form-control" formControlName="ovh_ind_porc" (ngModelChange)="calculate_overhead()">
                          <div  *ngIf="form_totalesPiezas.get('ovh_ind_porc')?.invalid && (form_totalesPiezas.get('ovh_ind_porc')?.dirty || form_totalesPiezas.get('ovh_ind_porc')?.touched)">
                            <small *ngIf="form_totalesPiezas.get('ovh_ind_porc')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                            <small *ngIf="form_totalesPiezas.get('ovh_ind_porc')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">OVERHEAD</label>
                          <input type="number" class="form-control disabled" formControlName="overhead" [readOnly]="true">
                          <small *ngIf="form_totalesPiezas.get('overhead')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">MARGIN OVERHEAD</label>
                          <input type="number" class="form-control disabled" formControlName="margin_overhead" [readOnly]="true">
                          <small *ngIf="form_totalesPiezas.get('margin_overhead')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">% PROFITT</label>
                          <input type="number" class="form-control" formControlName="profitt_percent">
                          <div  *ngIf="form_totalesPiezas.get('profitt_percent')?.invalid && (form_totalesPiezas.get('profitt_percent')?.dirty || form_totalesPiezas.get('profitt_percent')?.touched)">
                            <small *ngIf="form_totalesPiezas.get('profitt_percent')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                            <small *ngIf="form_totalesPiezas.get('profitt_percent')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (6,4)</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">PROFITT</label>
                          <input type="number" class="form-control disabled" formControlName="profitt" [readOnly]="true">
                          <small *ngIf="form_totalesPiezas.get('profitt')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">MARGIN PROFIT</label>
                          <input type="number" class="form-control disabled" formControlName="margin_profitt" [readOnly]="true">
                          <small *ngIf="form_totalesPiezas.get('margin_profitt')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">UNIT PRICE</label>
                          <input type="number" class="form-control disabled" formControlName="unit_price" [readOnly]="true">
                          <small *ngIf="form_totalesPiezas.get('unit_price')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">MARGIN TOTAL</label>
                          <input type="number" class="form-control disabled" formControlName="margin_total" [readOnly]="true">
                          <small *ngIf="form_totalesPiezas.get('margin_total')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
    <!-- TOTALES -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="panelHead-Totales">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelTotales" aria-expanded="false" aria-controls="panelTotales">
                      Totales
                    </button>
                  </h2>
                  <div id="panelTotales" class="accordion-collapse collapse" aria-labelledby="panelHead-Totales">
                    <div class="accordion-body">
                      <form class="row" [formGroup]="form_totales">
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">Kg MATERIAL</label>
                          <input type="number" class="form-control disabled" formControlName="kg_material" [readOnly]="true">
                          <small *ngIf="form_totales.get('kg_material')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label">MOQ</label>
                          <input type="number" class="form-control disabled" formControlName="moq" [readOnly]="true">
                          <div  *ngIf="form_totales.get('moq')?.invalid && (form_totales.get('moq')?.dirty || form_totales.get('moq')?.touched)">
                            <small *ngIf="form_totales.get('moq')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">EAU</label>
                          <input type="number" class="form-control" formControlName="eau" (ngModelChange)="calculate_pcs_mtto()">
                          <div  *ngIf="form_totales.get('eau')?.invalid && (form_totales.get('eau')?.dirty || form_totales.get('eau')?.touched)">
                            <small *ngIf="form_totales.get('eau')?.errors?.['required']" class="text-danger text">❌ Campo Numerico Requerido</small>
                          </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                          <label for="" class="form-label txtLabel-lg">Total</label>
                          <input type="text" class="form-control disabled" formControlName="total" [readOnly]="true">
                          <small *ngIf="form_totales.get('total')?.errors?.['pattern']" class="text-danger text">❌ El campo debe tener un formato decimal (11,4)</small>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row d-flex justify-content-center mt-5">
                <div class="row"  *ngIf="flagEdit_itemCot">
                  <div class="col-sm-12 col-md-6 text-center ">
                    <button class="btn btn-teal" (click)="confirmarEdicionItem()">Confirmar Edicion Item</button>
                  </div>
                  <div class="col-sm-12 col-md-6 text-center">
                    <button class="btn btn-danger" (click)="cancelarEdicionItem()">Cancelar Edicion de item</button>
                  </div>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2" *ngIf="!flagEdit_itemCot">
                  <button *ngIf="!action" type="button" (click)="addItemCotizacion()" class="btn btn-teal btnCentrar">Agregar ítem</button>
                </div>
              </div>
            </div>
          </div>
    
          <div class="my-3 p-4 bg-body rounded shadow-sm">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th class="th0"><span>CÓDIGO PARTE</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th4"><span>DESCRIPCIÓN PARTE</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>UNIT PRICE</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>MATERIALES</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>% MATERIALES</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>PRODUCCIÓN</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>% PRODUCCIÓN</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th7"><span>EMPAQUE Y LOGÍSTICA</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th7"><span>% EMPAQUE Y LOGÍSTICA</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th0"><span>MANTENIMIENTO</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th0"><span>% MANTENIMIENTO</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>Kg MATERIAL</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>EAU</span> <a href="#" class="thFlechas"></a></th>
                    <th class="th5"><span>TOTAL</span> <a href="#" class="thFlechas"></a></th>
                    <th class="text-center th2">ACCIONES</th>
                  </tr>
                </thead>
                <tbody *ngFor="let item of array_items_cotizacion; let i = index">
                  <!-- PRODUCTO -->
                  <tr>
                    <td class="fw-bolder">{{item.codigo_parte}}</td>
                    <td>{{ item.descripcion_parte }}</td>
                    <td class="tdIzq">{{item.unit_price | currency}}</td>
                    <td class="tdIzq">{{obtener_totalMateriaPrima(item) | currency}}</td>
                    <td class="tdIzq">{{ ((obtener_totalMateriaPrima(item) / item.unit_price)*100).toFixed(4) }}%</td>
                    <td class="tdIzq">{{obtener_totalProduction(item) | currency}}</td>
                    <td class="tdIzq">{{((obtener_totalProduction(item) / item.unit_price)*100).toFixed(4)}}%</td>
                    <td class="tdIzq">{{obtener_totalEmpaqueLogistica(item) | currency}}</td>
                    <td class="tdIzq">{{((obtener_totalEmpaqueLogistica(item) / item.unit_price)*100).toFixed(4)}}%</td>
                    <td class="tdIzq">{{obtener_mantenimiento(item) | currency}}</td>
                    <td class="tdIzq">{{((obtener_mantenimiento(item) / item.unit_price)*100).toFixed(4)}}%</td>
                    <td class="tdIzq">{{item.kg_material}}</td>
                    <td class="tdIzq">{{item.eau}}</td>
                    <td class="tdIzq">{{item.total | currency}}</td>
                    <td class="text-center" *ngIf="!action">
                      <button type="button" (click)="editarItemCot(i,item)" title="Modificar" class="btn-icon-action"><img src="assets/img/ic-editar.png"></button>
                      <button type="button" (click)="eliminarItemCot(i)" title="Eliminar" class="btn-icon-action"><img src="assets/img/ic-eliminar.png"></button>
                    </td>
                    <td class="text-center"  *ngIf="action">
                      <button type="button" (click)="checkItem(item)" title="Modificar" class="btn-icon-action"><img src="assets/img/ic-detalle.png"></button>
                    </td>
                  </tr>
                  <!-- EL SIGUIENTE TR forma parte de la información de arriba -->
                  <tr class="subTable">
                    <td colspan="4" class="tdInt"> 
                      <table class="table table-materia table-bordered mt-2 table-hover-materia">
                        <tr *ngFor="let item_mp of item.materias_primas; let i = index">
                          <td class="tdHead text-center">Materia Prima {{i + 1}}</td>
                          <td class="tdHead-Descripcion">{{item_mp.descripcion_materia_prima}}</td>
                          <td class="tdIzq tdHead-Materiales">${{item_mp.total_mat}}</td>
                        </tr>
                      </table>
                    </td> 
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row justify-content-end mt-3">
              <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xxl-2 totales">
                <div class="row">
                  <div class="col-1 d-none d-sm-block"></div>
                  <div class="col-12 col-sm-11 contTotales">
                    <span class="float-start">TOTAL</span>
                    <span class="float-end">{{total_cotizacion | currency}}</span>
                  </div>
                  <div class="col-1"></div>
                </div>
              </div>     
              <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xxl-2 totales">
                <div class="row">
                  <div class="col-1 d-none d-md-block"></div>
                  <div class="col-12 col-md-11 contTotales">
                    <span class="float-start">IMPUESTOS</span>
                    <span class="float-end">{{impuetsos_cotizacion | currency}}</span>
                  </div>
                </div>
              </div> 
              <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xxl-2 totales">
                <div class="row">
                  <div class="col-12 contTotales">
                    <span class="float-start fw-bolder">GRAN TOTAL</span>
                    <span class="float-end fw-bolder">{{gran_total_cotizacion | currency}}</span>
                  </div>
                </div>
              </div>  
            </div>
            <!-- termina tabla -->
            <div class="row mt-5 mb-4" *ngIf="!action">
              <div class="col-6">
                <button type="button" (click)="guardarCotizacion()" class="btn btn-teal float-end">Guardar</button> 
              </div>
              <div class="col-6">
                <button type="button" class="btn btn-gris float-start" onclick="history.back()">Cancelar</button> 
              </div>
            </div>

            <div class="row mt-5 mb-4" *ngIf="action">
              <div class="col-6">
                <button #botonStart type="button"  data-bs-toggle="modal" data-bs-target="#PDFcotizacion" class="btn btn-teal float-end">PDF Ctozacion</button> 
              </div>
              <div class="col-6">
                <button type="button" class="btn btn-gris float-start" onclick="history.back()">Cancelar</button> 
              </div>
            </div>
          </div> 
</main>

<!-- MODAL PDF -->
<div class="modal fade" id="PDFcotizacion" tabindex="-1" aria-labelledby="modalPDF" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" [formGroup]="form_pdf" (submit)="downloadPDF()">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="modalPDF">Generar PDF Cotización</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
          <h6>Tipo de documento</h6>
          <div class="row mb-4">
            <div class="col-5">
              <input class="form-check-input" type="radio" id="tipo_documento_Normal" name="tipo_documento" [value]="'Normal'" formControlName="tipo_documento">
              <label class="form-check-label" for="tipo_documento_Normal">Normal</label>
            </div>
            <div class="col-5">
              <input class="form-check-input" type="radio" id="tipo_documento_Ampliado" name="tipo_documento" [value]="'Ampliado'" formControlName="tipo_documento">
              <label class="form-check-label" for="tipo_documento_Ampliado">Ampliado</label>
            </div>
            <div class="col-5"></div>
          </div>
          <h6>Condiciones</h6>
          <div class="row mb-4">
            <div class="col-12 mb-2">
              <div class="row">
                <div class="col-1">
                  <input class="form-check-input float-end" type="checkbox" id="condiciones_empaqueEstandar" formControlName="condiciones_empaqueEstandar" name="condiciones_empaqueEstandar">
                </div>
                <div class="col-9 col-sp">
                  <label class="form-check-label" for="condiciones_empaqueEstandar">Empaque estándar.</label>
                </div>
              </div>
              <div class="row">
                <div class="col-1">
                  <input class="form-check-input float-end" type="checkbox" id="condiciones_materiaPrima" formControlName="condiciones_materiaPrima" name="condiciones_materiaPrima">
                </div>
                <div class="col-9 col-sp">
                  <label class="form-check-label" for="condiciones_materiaPrima">Materia prima proporcionada por el cliente.</label>
                </div>
              </div>
              <div class="row">
                <div class="col-1">
                  <input class="form-check-input float-end" type="checkbox" id="condiciones_OCmoq" formControlName="condiciones_OCmoq" name="condiciones_OCmoq">
                </div>
                <div class="col-9 col-sp">
                  <label class="form-check-label" for="condiciones_OCmoq">OC debe cumplir MOQ.</label>
                </div>
              </div>
              <div class="row">
                <div class="col-1">
                  <input class="form-check-input float-end" type="checkbox" id="condiciones_EntregaCliente" formControlName="condiciones_EntregaCliente" name="condiciones_EntregaCliente">
                </div>
                <div class="col-9 col-sp">
                  <label class="form-check-label" for="condiciones_EntregaCliente">Entrega en planta del cliente.</label>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12 col-sm-6 mb-3">
              <label for="" class="form-label txtLabel-lg">TIEMPO DE ENTREGA</label>
              <input type="text" class="form-control" formControlName="tiempo_entrga" name="tiempo_entrga">
            </div>
            <div class="col-12 col-sm-6 mb-3">
              <label for="" class="form-label txtLabel-lg">CONDICIONES DE PAGO</label>
              <input type="text" class="form-control" formControlName="condiciones_pago"  name="condiciones_pago">
            </div>
            <div class="col-12 col-sm-6 mb-3">
              <label for="" class="form-label txtLabel-lg">VIGENCIA</label>
              <input type="text" class="form-control" formControlName="vigencia"  name="vigencia">
            </div>
          </div>
      </div>
      <div class="row justify-content-center rowBotones">
        <div class="col-6 mb-3">
          <button type="submit" [disabled]="form_pdf.invalid" class="btn btn-teal float-end"><span *ngIf="form_pdf.invalid">🔒</span> Generar</button>
        </div>
        <div class="col-6 mb-3">
          <button type="button" class="btn btn-gris float-start" data-bs-dismiss="modal">Salir</button>
        </div>
      </div>
    </form>
  </div>
</div>